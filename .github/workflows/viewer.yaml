name: Get Viewer Details

on:
  workflow_dispatch:

permissions:
  contents: read

jobs:
  get-viewer-details:
    runs-on: ubuntu-latest
    
    steps:
    - name: Get viewer details
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      run: |
        echo "Viewer details:"
        gh api graphql --paginate --field query='
          query {
            viewer {
              login
              name
              email
              company
              location
              avatarUrl
              websiteUrl
              bio
              isBountyHunter
              isEmployee
              isDeveloperProgramMember
              organizations(first: 100) {
                nodes {
                  name
                  description
                  avatarUrl
                  membersWithRole {
                    totalCount
                  }
                }
                pageInfo {
                  hasNextPage
                  endCursor
                }
              }
              repositories(first: 100) {
                nodes {
                  nameWithOwner
                  description
                  isPrivate
                  isFork
                  isArchived
                  isDisabled
                  isTemplate
                  viewerPermission
                  viewerSubscription
                }
                pageInfo {
                  hasNextPage
                  endCursor
                }
              }
              starredRepositories {
                totalCount
              }
              watching {
                totalCount
              }
              followers {
                totalCount
              }
              following {
                totalCount
              }
            }
          }
        ' --jq '.data.viewer'
